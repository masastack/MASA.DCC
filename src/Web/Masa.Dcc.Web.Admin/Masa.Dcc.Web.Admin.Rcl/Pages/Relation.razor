@inherits MasaCompontentBase
@page "/relation"

<SheetDialog @bind-Value="Value" Title="@T("Relation public config")" Icon="mdi-circle" IconColor="success">
    <div class="d-flex flex-column" style="width:100%; height:100%; padding: 48px 228px">
        <div>
            <div class="text-h6 d-flex align-center">
                @AppDetail.Name
                <span class="ml-3 text-caption">|</span>
                <sapn class="ml-2 text-caption">@AppDetail.Identity</sapn>
            </div>
            <p class="neutral--text mt-12" style="font-size:14px; font-weight:700;">需要关联的集群</p>
            <MChipGroup Multiple Column @bind-Values="_selectEnvClusterIds">
                @foreach (var item in AppDetail.EnvironmentClusters)
                {
                    <MChip Value="item.Id" Large Class="envClusterChip mr-6 mb-6" Filter Outlined ActiveClass="@($"{item.EnvironmentColor}")">
                        <div class="@($"{item.EnvironmentColor}--text")">@item.EnvironmentName</div>&nbsp;&nbsp;
                        <div style="color:#05CD99">@item.ClusterName</div>
                    </MChip>
                }
            </MChipGroup>
            <p class="neutral--text mt-12" style="font-size:14px; font-weight:700;">选择公共配置对象</p>
            <MSelect Value="_selectPublicConfigObjectId"
                     ValueChanged="SelectConfigObjectValueChanged"
                     TValue="int"
                     TItemValue="int"
                     TItem="ConfigObjectDto"
                     Label="项目"
                     MenuProps="props => props.OffsetY = true"
                     Outlined
                     Dense
                     Items="_publicConfigObjects"
                     ItemText="l=>l.Name"
                     ItemValue="l=>l.Id">
            </MSelect>
            @if (_selectConfigObject.FormatLabelCode.Trim().ToLower() == "properties")
            {
                <div style="border-radius: 8px; border: 1px solid #E2E7F4; padding:12px 24px;">
                    <MRow Style="color: #A3AED0; font-size: 14px;" NoGutters>
                        <span class="d-flex justify-center" style="width: 5%">状态</span>
                        <span style="width: 47.5%">Key</span>
                        <span style="width: 47.5%">Value</span>
                    </MRow>
                    <MDivider Class="mt-3 mx-n6"></MDivider>
                    @foreach (var item in _selectConfigObject.ConfigObjectPropertyContents)
                    {
                        <MRow Class="pt-4" NoGutters Justify="JustifyTypes.SpaceBetween">
                            @if (item.IsRelationed)
                            {
                                <MIcon Color="#7681AB">mdi-link-variant</MIcon>
                            }
                            else
                            {
                                <MIcon Color="#7681AB">mdi-unlink-variant</MIcon>
                            }
                            <MIcon Class="hover-pointer">mdi-link-variant</MIcon>
                            <div>@item.Key</div>
                            <MTextField Dense HideDetails="true" Outlined TValue="string" Value="item.Value" ValueChanged="value=>PropertyValueChanged(value,item)" Label="Value"></MTextField>
                        </MRow>
                    }
                </div>
            }
            else
            {
                if (_isRelation)
                {
                    <MIcon Color="#7681AB">mdi-link-variant</MIcon>
                }
                else
                {
                    <MIcon Color="#7681AB">mdi-unlink-variant</MIcon>
                }
                <MTextarea Dense Outlined Value="@_selectConfigObject.Content" ValueChanged="value=>ContentValueChanged(value,_selectConfigObject)"></MTextarea>
            }
        </div>
        <div class="d-flex justify-end align-end" style="width:100%; height:100%;">
            <MButton Class="rounded-pill" Color="primary" Width="100" OnClick="HandleOnSubmitAsync">提交</MButton>
        </div>
    </div>
</SheetDialog>
